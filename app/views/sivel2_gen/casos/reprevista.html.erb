<!DOCTYPE html>
<html>
  <head>
    <title>Reporte Revista</title>
    <style>
      .alerta {
        color: red;
      }
    </style>
  </head>
  <body>
    <% @conscaso.try(:each) do |caso| %>
      <a href='<% sivel2_gen.caso_path(caso.caso_id) %>'><%= caso.caso_id %></a>
      <p>
        <!-- % if @incluir.include?('casoid') %-->
          <!--%= link_to caso.caso_id, sivel2_gen.caso_path(caso.caso_id) %-->
        <!--% end %-->
        <% if @incluir.include?('fecha') %>
          <%= I18n.localize(caso.fecha, format: '%B %d/%Y').capitalize %>
        <% end %>
      </p>
        <% @caso = Sivel2Gen::Caso.find(caso.caso_id) %>
      <p>
        <% if caso.ubicacion.count == 0 %>
          <div class='alerta'>Caso sin ubicaci√≥n</div>
        <% elsif caso.ubicacion.count >= 1 %>
            <% ubi_principal = Sip::Ubicacion.find(@caso.ubicacion_id) %>
            <% if ubi_principal.departamento %>
              DEPARTAMENTO: <%= ubi_principal.departamento.nombre%> 
            <% end %>
            <% if ubi_principal.municipio %>
              <br>MUNICIPIO: <%= ubi_principal.municipio.nombre%> 
            <% end %>
            <% if caso.ubicacion.count > 1 %>
              <p class='alerta'>Caso con varias ubicaciones, (Principal mostrada)</p>
            <% end %>
        <% elsif caso.ubicacion[0].departamento == nil %>
          <div class='alert'>Ubicacion sin departamento</div>
        <% end %>
      </p>
        <% @markdown ||= Redcarpet::Markdown.new(Redcarpet::Render::HTML, {
          autolink: true,
          space_after_headers: true,
          fenced_code_blocks: true,
          underline: true,
          highlight: true,
          tables: true }) %>
        <% c = @markdown.render(caso.memo).html_safe %>
        <table>
          <tr><td><tt>
                <%= c %>
          </tt></td></tr>
        </table>
     <% @caso.acto.each do |ac| %>
      <p>
       <% supraid = ac.categoria.supracategoria_id%>
       <% tviolencia = Sivel2Gen::Supracategoria.find(supraid).id_tviolencia if supraid%>
       <% pr = Sivel2Gen::Presponsable.find(ac.id_presponsable).nombre %>
       <% tv_nombre = Sivel2Gen::Tviolencia.find(tviolencia).nombre if tviolencia%>
       <% supra_nombre = Sivel2Gen::Supracategoria.find(supraid).nombre if supraid%>
       Presunto Responsable: <%= pr %> </br>
       <%= tv_nombre%></br>
       <%= supra_nombre%></br>
       <%= ac.categoria.nombre%> </br>
       <% victima = Sivel2Gen::Victima.where(id_persona: ac.id_persona)[0]%>
       <%= Sip::Persona.find(victima.id_persona).nombres +
         ' ' + Sip::Persona.find(ac.id_persona).apellidos %> 
       -
       <%= Sivel2Gen::Sectorsocial.find(victima.id_sectorsocial).nombre%></br>
     </p>
     <% end %>
     <% @caso.actocolectivo.each do |ac| %>
     <p>
       <% supraid = ac.categoria.supracategoria_id%>
       <% tviolencia = Sivel2Gen::Supracategoria.find(supraid).id_tviolencia if supraid%>
       <% pr = Sivel2Gen::Presponsable.find(ac.id_presponsable).nombre %>
       <% tv_nombre = Sivel2Gen::Tviolencia.find(tviolencia).nombre if tviolencia%>
       <% supra_nombre = Sivel2Gen::Supracategoria.find(supraid).nombre if supraid%>
       Presunto Responsable: <%= pr %> </br>
       <%= tv_nombre %> </br>
       <%= supra_nombre %> </br>
       <%= ac.categoria.nombre%></br> 
       <%= Sip::Grupoper.find(ac.id_grupoper).nombre %></br> 
     </p>
     <% end %>
    <% end %>
  </body>
</html>
